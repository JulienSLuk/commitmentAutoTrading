<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Car Gallery</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
  h1, h2 { text-align: center; margin-bottom: 30px; }
  .gallery { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
  .car-card { background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 15px; width: 300px; text-align: center; }
  .car-card h2 { margin: 10px 0; }
  .car-card img { max-width: 100%; max-height: 200px; border-radius: 8px; display: block; margin: 0 auto 10px; }
  .details { margin: 10px 0; font-size: 14px; color: #333; text-align: left; }
  .controls { display: flex; justify-content: space-between; margin-top: 10px; }
  .controls button { padding: 5px 10px; border: none; background: #007bff; color: white; border-radius: 5px; cursor: pointer; }
  .controls button:hover { background: #0056b3; }

  /* Loader Styles */
  #loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .spinner {
    border: 8px solid #f3f3f3;
    border-top: 8px solid #007bff;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }

  /* Contact Form */
  form { display: flex; flex-direction: column; }
  input, textarea { margin: 5px 0 15px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 100%; }
  button.submit-btn { padding:10px 20px; border:none; background:#007bff; color:white; border-radius:5px; cursor:pointer; }
  button.submit-btn:hover { background:#0056b3; }
  #form-status { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<h1>Car Gallery</h1>
<div id="loader">
  <div class="spinner"></div>
</div>

<div class="gallery" id="gallery" style="display:none;"></div>

<h2>Contact Me</h2>
<div style="max-width:500px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1);">
  <form id="contact-form" action="https://formspree.io/f/xnnzkzao" method="POST">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>

    <label for="email">Email:</label>
    <input type="email" id="email" name="_replyto" required>

    <label for="message">Message:</label>
    <textarea id="message" name="message" rows="5" required></textarea>

    <button type="submit" class="submit-btn">Send Message</button>
  </form>
  <p id="form-status"></p>
</div>

<script>
async function loadCars() {
  try {
    const loader = document.getElementById("loader");
    const gallery = document.getElementById("gallery");

    // 1️⃣ Load images data (Python-generated cars.json)
    const imagesRes = await fetch("cars.json");
    const imagesData = await imagesRes.json();

    // 2️⃣ Load details from Google Sheets JSON endpoint
    const sheetRes = await fetch("https://script.google.com/macros/s/AKfycbwNRd_OfUf9woVZsuYw6UVrQXFteqH-qxQwU3NHKDvNqQXNx2kKb1GP1iBIrxS9r9W8Rg/exec");
    const sheetData = await sheetRes.json();

    imagesData.forEach(car => {
      const details = sheetData.find(d => d.Name.toLowerCase() === car.name.toLowerCase()) || {};

      let currentIndex = 0;
      const card = document.createElement("div");
      card.className = "car-card";

      const title = document.createElement("h2");
      title.textContent = car.name;

      const img = document.createElement("img");
      img.src = car.images[currentIndex];

      const detailsDiv = document.createElement("div");
      detailsDiv.className = "details";

      Object.keys(details).forEach(key => {
        if (key.toLowerCase() !== "name" && details[key]) {
          const p = document.createElement("p");
          p.innerHTML = `<strong>${key}:</strong> ${details[key]}`;
          detailsDiv.appendChild(p);
        }
      });

      const controls = document.createElement("div");
      controls.className = "controls";

      const prevBtn = document.createElement("button");
      prevBtn.textContent = "← Prev";
      prevBtn.onclick = () => {
        currentIndex = (currentIndex - 1 + car.images.length) % car.images.length;
        img.src = car.images[currentIndex];
      };

      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Next →";
      nextBtn.onclick = () => {
        currentIndex = (currentIndex + 1) % car.images.length;
        img.src = car.images[currentIndex];
      };

      controls.appendChild(prevBtn);
      controls.appendChild(nextBtn);

      card.appendChild(title);
      card.appendChild(img);
      card.appendChild(detailsDiv);
      card.appendChild(controls);

      gallery.appendChild(card);
    });

    loader.style.display = "none";
    gallery.style.display = "flex";

  } catch (err) {
    console.error("Error loading cars:", err);
    document.getElementById("loader").innerHTML = "<p>Failed to load car data.</p>";
  }
}

// Contact form handler
const form = document.getElementById("contact-form");
const status = document.getElementById("form-status");

form.addEventListener("submit", function(event) {
  event.preventDefault();
  const formData = new FormData(form);
  fetch(form.action, {
    method: form.method,
    body: formData,
    headers: { 'Accept': 'application/json' }
  })
  .then(response => {
    if (response.ok) {
      status.textContent = "Thanks! Your message has been sent.";
      status.style.color = "green";
      form.reset();
    } else {
      response.json().then(data => {
        status.textContent = data.errors ? data.errors.map(e => e.message).join(", ") : "Oops! There was a problem.";
        status.style.color = "red";
      });
    }
  })
  .catch(error => {
    status.textContent = "Oops! There was a problem sending your message.";
    status.style.color = "red";
  });
});

// Load gallery
loadCars();
</script>

</body>
</html>
